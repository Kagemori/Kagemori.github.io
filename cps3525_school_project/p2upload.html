<html>
<body>
   <form enctype = "multipart/form-data" action = "../cgi-bin/project2.py" method = "post">
   <p>Select zipcode file: <input type = "file" name = "zipcodefile" id ="zipcodefile"/></p>
   <p>Select state file: <input type = "file" name = "statefile" id ="statefile"/></p>
   <input type = "submit" value = "Upload" name="submit"/>
   </form>

   <h3>Runs the following Python code upon Uploading</h3>
   <textarea style="width: 80%; height: 55%;" readonly>
    #!/usr/bin/env python
import cgi, os, shutil, subprocess, smtplib, datetime
from email.MIMEMultipart import MIMEMultipart
from email.MIMEText import MIMEText
import cgitb; cgitb.enable()

form = cgi.FieldStorage()
print "Content-type: text/html\r\n"
fileitem = form['zipcodefile']
fileitem2 = form['statefile']

#checks if files are uploadable
if fileitem.filename:
    fn = os.path.basename(fileitem.filename)
    fn = os.path.basename(fileitem.filename.replace("\\","/"))
    open('../CPS3525/upload/' + fn, 'wb').write(fileitem.file.read())
    message = 'The file "' + fn + '" was uploaded successfully'
else:
    message = 'No file was uploaded' 
if fileitem2.filename:
    fn = os.path.basename(fileitem2.filename)
    fn = os.path.basename(fileitem2.filename.replace("\\","/"))
    open('../CPS3525/upload/' + fn, 'wb').write(fileitem2.file.read())
    message2 = 'The file "' + fn + '" was uploaded successfully'
else:
    message2 = 'No file was uploaded'

#print in html format
print """\
&lt;html&gt;
    &lt;body&gt; 
    &lt;p&gt; %s &lt;/p&gt;
&lt;p&gt; %s &lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
"""%(message,message2)

#subprocess.call(["javac Project2.java"])

output = subprocess.check_output(["java", "Project2"])
print(output)

currentdt = datetime.datetime.now()
dt = currentdt.strftime("%m/%d/%Y, %H:%M:%S")

sender = "estrekei@yoda.kean.edu"
receiver = "chuang@kean.edu"

msg = MIMEMultipart()
msg['From'] = sender
msg['To'] = receiver
msg['Subject'] = "CPS3525 Project 2 Result"
body = "The Java program was run at " + dt + ", and the result is available at yoda.kean.edu/~estrekei/CPS3525/upload/Project2_results.html"
msg.attach(MIMEText(body,'plain'))
text = msg.as_string()

smtpObj = smtplib.SMTP('localhost')
smtpObj.sendmail(sender, receiver, text)

</textarea>

<h3>Runs the following Java code from the Python code</h3>
<textarea style="width: 80%; height: 55%;" readonly>
    import java.util.*;
import java.io.*;

public class Project2 {
	public static void main(String[] args) throws IOException {
		
		//Reads the state csv and turns it into a csv array
		String pathToCsv = "../CPS3525/upload/project2_state.csv";
		String thisLine; 
		BufferedReader csvReader = new BufferedReader(new FileReader(pathToCsv));
		List&lt;String[]&gt; lines = new ArrayList&lt;String[]&gt;();
		while ((thisLine = csvReader.readLine()) != null) {
			lines.add(thisLine.split(",(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)", -1));
		}
		csvReader.close();
		String[][] arrayStates = new String[lines.size()][0];
		lines.toArray(arrayStates);
		
		//Reads the zipcode csv and turns it into a 2d array
		String pathToCsv2 = "../CPS3525/upload/project2_zipcode.csv";
		BufferedReader csvReader2 = new BufferedReader(new FileReader(pathToCsv2));
		List&lt;String[]&gt; lines2 = new ArrayList&lt;String[]&gt;();
		while ((thisLine = csvReader2.readLine()) != null) {
			lines2.add(thisLine.split(",(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)", -1));
		}
		csvReader2.close();
		String[][] arrayStateZips = new String[lines2.size()][0];
		lines2.toArray(arrayStateZips);
		
		//Multidimensional array with different types, makes use of type object
		Object[][] tableArr = new Object[arrayStates.length][5];
		tableArr[0][0] = new String("State");
		tableArr[0][1] = new String("Capital");
		tableArr[0][2] = new String("Number_of_zipcodes");
		tableArr[0][3] = new String("Total_Estimated_Population");
		tableArr[0][4] = new String("Average_AvgWages");
		
		//Fills in 2d array for output
		for(int y = 1; y &lt; tableArr.length; y++) {
			tableArr[y][0] = new String(arrayStates[y][1]);
			tableArr[y][1] = new String(arrayStates[y][3]);
			
			String name = (String) tableArr[y][0];
			tableArr[y][2] = countZipcodes(arrayStateZips,name);
			tableArr[y][3] = totalEstPopu(arrayStateZips,name);
			tableArr[y][4] = avgWages(arrayStateZips,name);
		}
		
		//Counts the states where there are zipcodes present
		int arrx = 0;
		int arry = 0;
		for(int i = 1; i &lt; tableArr.length; i++) {
			int temp = (int) tableArr[i][2];
			for(int j = 0; j &lt; tableArr[1].length; j++) {
				if(temp != 0) {
					arry++;
				}
			}
			if(temp != 0) {
				arrx++;
			}
		}
		
		htmlTable(arrx, arry, tableArr, arrayStateZips);
		
	}
	
	//Method that finds and counts the zipcodes of each state using their acronym
	public static int countZipcodes(String [][] arr, String state) {
		int totalZip = 0;
		String stateCsv;
		
		for(int i = 0; i &lt; arr.length; i++) {
			stateCsv = arr[i][4];
			if(state.equalsIgnoreCase(stateCsv)) {
				totalZip = totalZip + 1;
			}
		}
		
		return totalZip;
	}
	
	//Method that sums the estimated population for each state from zipcode csv
	public static int totalEstPopu(String [][] arr, String state) {
		int totalPop = 0;
		String stateCsv;
		
		for(int i = 0; i &lt; arr.length; i++) {
			stateCsv = arr[i][4];
			if(state.equalsIgnoreCase(stateCsv)) {
				int temp = Integer.parseInt(arr[i][17]);
				totalPop = totalPop + temp;
			}
		}
		
		return totalPop;
	}
	
	//Method that sums and averages the average wages of each state
	public static double avgWages(String [][] arr, String state) {
		double averageWages = 0;
		int count = 0;
		String stateCsv;
		
		for(int i = 0; i &lt; arr.length; i++) {
			stateCsv = arr[i][4];
			if(state.equalsIgnoreCase(stateCsv) && arr[i][19].isEmpty() != true) {
				double temp = Double.parseDouble(arr[i][19]);
				averageWages = averageWages + temp;
				count = count + 1;
			}
		}
		
		if(count != 0) {
			averageWages = (averageWages / count );
		}
		
		return averageWages;
	}
	
	//Finds zipcode searched for and returns a string of outputs
	public static String zipLookup(String [][] arr, int zipcode) {
		String output = "";
		
		for(int i = 1; i &lt; arr.length; i++) {
			int temp = Integer.parseInt(arr[i][1]);
			for(int j = 0; j &lt; arr[1].length; j++) {
				if(zipcode == temp) {
					double tempo = Double.parseDouble(arr[i][19]);
					String temps = arr[i][13];
					temps = temps.replace("\"","");
					output = "Zipcode " + zipcode + " at " + temps + " has the maximum population " + arr[i][17] + " with AvgWages $" + round(tempo,1);
				}
			}
		}
		
		return output;
	}
	
	//rounding function
	public static double round(double value, int places) {
	    if (places &lt; 0) throw new IllegalArgumentException();

	    long factor = (long) Math.pow(10, places);
	    value = value * factor;
	    long tmp = Math.round(value);
	    return (double) tmp / factor;
	}
	
	public static void htmlTable(int arrx, int arry, Object [][] arr, String [][] arr2) {
		Object [][] tableArr = new Object[arry][arrx];
		Object [][] sortedTable = new Object[arry][arrx];
		int count = 0;
		
		//Creates separate object array for values that are shown.
		for(int i = 1; i &lt; arr.length; i++) {
			int temp = (int) arr[i][2];
			for(int j = 0; j &lt; arr[1].length; j++) {
				if(temp != 0) {
					tableArr[count][j] = arr[i][j];
				}
			}
			if(temp != 0) {
				count++;
			}
		}
		
		//Sorts the object array by descending avgwage value
		int index = 0; int counter =0; double value = (double)tableArr[0][4];
		while(counter != tableArr[1].length) {
			for(int z = 0; z &lt; tableArr[1].length; z++) {
				if(value &lt; (double)tableArr[z][4]) {
					value = (double) tableArr[z][4];
					index = z;
				}
			}
			tableArr[index][4] = 0.0;
			sortedTable[counter][0] = tableArr[index][0];
			sortedTable[counter][1] = tableArr[index][1];
			sortedTable[counter][2] = tableArr[index][2];
			sortedTable[counter][3] = tableArr[index][3];
			sortedTable[counter][4] = round(value,1);
			counter++;
			value = -1;
		}
		
		//System printout
		System.out.println("Content-type:text/html\r\n\r\n");
		System.out.println("&lt;html&gt;\n");
		System.out.println("&lt;head&gt;\n");
		System.out.println("&lt;style&gt;\r\n table, th, td {\r\n   border: 1px solid black;\r\n }\r\n &lt;/style&gt;");
		System.out.println("&lt;title&gt;Project 3 Output&lt;/title&gt;\n");
		System.out.println("&lt;/head&gt;\n");
		System.out.println("&lt;body&gt;\n");
		System.out.println("&lt;table style=\"width:100%\"&gt;");
			System.out.println("&lt;tr&gt;");
				System.out.println("&lt;th&gt;" + arr[0][0] + "&lt;/th&gt;");
				System.out.println("&lt;th&gt;" + arr[0][1] + "&lt;/th&gt;");
				System.out.println("&lt;th&gt;" + arr[0][2] + "&lt;/th&gt;");
				System.out.println("&lt;th&gt;" + arr[0][3] + "&lt;/th&gt;");
				System.out.println("&lt;th&gt;" + arr[0][4] + "&lt;/th&gt;");
			System.out.println("&lt;/tr&gt;");
		for(int i = 0; i &lt; sortedTable[1].length; i++) {
			System.out.println("&lt;tr&gt;");
				System.out.println("&lt;td&gt;" + sortedTable[i][0] + "&lt;/td&gt;");
				System.out.println("&lt;td&gt;" + sortedTable[i][1] + "&lt;/td&gt;");
				System.out.println("&lt;td align='right'&gt;" + sortedTable[i][2] + "&lt;/td&gt;");
				System.out.println("&lt;td align='right'&gt;" + sortedTable[i][3] + "&lt;/td&gt;");
				System.out.println("&lt;td align='right'&gt;" + "$" + sortedTable[i][4] + "&lt;/td&gt;");
			System.out.println("&lt;/tr&gt;");
		}
		System.out.println("&lt;/table&gt; &lt;br/&gt;\n");
		System.out.println(zipLookup(arr2, 10156));
		System.out.println("&lt;br/&gt;\n");
		System.out.println("&lt;/body&gt;\n");
		System.out.println("&lt;/html&gt;\n");
		
		//Writing to file
		try {
			File file = new File("../CPS3525/upload/Project2_results.html");
			FileWriter writer = new FileWriter(file);
			writer.write("&lt;html&gt;\n" + "&lt;head&gt;\n" + "&lt;style&gt;\r\n table, th, td {\r\n   border: 1px solid black;\r\n }\r\n &lt;/style&gt;");
			writer.write("&lt;title&gt;Project 3 Output&lt;/title&gt;\n" + "&lt;/head&gt;\n" + "&lt;body&gt;\n" + "&lt;table style=\"width:100%\"&gt;");
			writer.write("&lt;tr&gt;" + "&lt;th&gt;" + arr[0][0] + "&lt;/th&gt;" + "&lt;th&gt;" + arr[0][1] + "&lt;/th&gt;" + "&lt;th&gt;" + arr[0][2] + "&lt;/th&gt;" + "&lt;th&gt;" + arr[0][3] + "&lt;/th&gt;" + "&lt;th&gt;" + arr[0][4] + "&lt;/th&gt;" + "&lt;/tr&gt;");
			for(int i = 0; i &lt; sortedTable[1].length; i++) {
				writer.write("&lt;tr&gt;");
				writer.write("&lt;td&gt;" + sortedTable[i][0] + "&lt;/td&gt;");
				writer.write("&lt;td&gt;" + sortedTable[i][1] + "&lt;/td&gt;");
				writer.write("&lt;td align='right'&gt;" + sortedTable[i][2] + "&lt;/td&gt;");
				writer.write("&lt;td align='right'&gt;" + sortedTable[i][3] + "&lt;/td&gt;");
				writer.write("&lt;td align='right'&gt;" + "$" + sortedTable[i][4] + "&lt;/td&gt;");
				writer.write("&lt;/tr&gt;");
			}
			writer.write("&lt;/table&gt; &lt;br/&gt;\n");
			writer.write(zipLookup(arr2, 10156));
			writer.write("&lt;br/&gt;\n");
			writer.write("&lt;/body&gt;\n");
			writer.write("&lt;/html&gt;\n");
			writer.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
		
		
	}
}
</textarea>
</body>
</html>